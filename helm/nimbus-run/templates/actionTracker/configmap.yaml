apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "actionTracker.fullname" . }}
  labels:
   {{- include "actionTracker.labels" . | nindent 4}}

data:
  {{ .Values.actionTracker.configMap.nimbusRun.keyName}}: |
    name: {{ .Values.actionTracker.settings.name }}
    retryPolicy:
      maxJobInQueuedInMinutes: {{ .Values.actionTracker.settings.retryPolicy.maxJobInQueuedInMinutes }}
      maxTimeBtwRetriesInMinutes: {{ .Values.actionTracker.settings.retryPolicy.maxTimeBtwRetriesInMinutes }}
      maxRetries: {{ .Values.actionTracker.settings.retryPolicy.maxRetries }}
    kafka:
      retryTopic: {{.Values.kafka.retryTopic.name}}
      webhookTopic: {{.Values.kafka.webhookTopic.name}}
      broker: {{ include "kafka-broker-url" . |squote}}
      consumerGroupId: {{ .Values.actionTracker.settings.kafkaConsumerGroup }}

    github:
      groupName: {{ .Values.github.groupName }}
    {{- with .Values.actionTracker.additionalSettings}}
        {{- toYaml . | nindent 4}}
    {{- end }}
